{%  extends 'admin_layout.twig' %}

{% block content %}
    {% embed "admin/templates/sidebar.twig" %}{% endembed %}
    <div class="main-content" id="panel">
        {% embed "admin/templates/header_nav.twig" %}{% endembed %}

        <div class="header bg-gradient-primary pb-8 pt-5 pt-md-8">
            <div class="container-fluid">
                <div class="header-body">
                    <!-- Card stats -->
                    <div class="row">
                        <div class="col-xl-3 col-lg-6">
                            <div class="card mb-4 mb-xl-0 shadow-sm">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <h5 class="card-title text-uppercase text-muted mb-0">Votes</h5>
                                            <span class="h2 font-weight-bold mb-0">{{ total_votes }}</span>
                                        </div>
                                        <div class="col-auto">
                                            <div class="icon icon-shape bg-danger text-white rounded-circle shadow">
                                                <i class="fal fa-chart-bar"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-lg-6">
                            <div class="card mb-4 mb-xl-0">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <h5 class="card-title text-uppercase text-muted mb-0">Users</h5>
                                            <span class="h2 font-weight-bold mb-0">{{ unique_users }}</span>
                                        </div>
                                        <div class="col-auto">
                                            <div class="icon icon-shape bg-warning text-white rounded-circle shadow">
                                                <i class="fal fa-users"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-lg-6">
                            <div class="card mb-4 mb-xl-0">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <h5 class="card-title text-uppercase text-muted mb-0">Claimed</h5>
                                            <span class="h2 font-weight-bold mb-0">{{ claimed }}</span>
                                        </div>
                                        <div class="col-auto">
                                            <div class="icon icon-shape bg-yellow text-white rounded-circle shadow">
                                                <i class="fal fa-vote-yea"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-lg-6">
                            <div class="card mb-4 mb-xl-0">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <h5 class="card-title text-uppercase text-muted mb-0">Pending</h5>
                                            <span class="h2 font-weight-bold mb-0">{{ pending }}</span>
                                        </div>
                                        <div class="col-auto">
                                            <div class="icon icon-shape bg-info text-white rounded-circle shadow">
                                                <i class="fal fa-vote-nay"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid mt--7">
            <div class="row">
                <div class="col-xl-12">
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-transparent">
                            <div class="row align-items-center">
                                <div class="col">
                                    <h6 class="text-uppercase text-muted ls-1 mb-1">Performance</h6>
                                    <h2 class="mb-0">Votes in the last 14 days</h2>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Chart -->
                            <div class="chart">
                                <canvas id="chart-orders" class="chart-canvas"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm mb-3 border-info">
                        <div class="card-body">
                            <h5 class="text-uppercase text-info ls-1 mb-1">Callback URL</h5>

                            <h2>{{ callback_url }}<code>?postback=</code></h2>

                            <p class="mb-0">If the callback is not working for a specific toplist, consult their documentation
                            on how the URL should be formatted. in some cases simply remove <code>?postback=</code></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        Chart.plugins.register({
            beforeDraw: function(chartInstance) {
                var ctx = chartInstance.chart.ctx;
                ctx.fillStyle = "rgba(0,0,0,0)";
                ctx.fillRect(0, 0, chartInstance.chart.width, chartInstance.chart.height);
            }
        });

        window.chartColors = {
            red:    'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green:  'rgb(75, 192, 192)',
            blue:   'rgb(54, 162, 235)',
            purple: 'rgb(94, 114, 228)',
            purpleLight: 'rgb(107, 129, 255)',
            grey:   'rgb(201, 203, 207)'
        };

        var options = {};

        options.maintainAspectRatio = false;
        options.response = true;
        options.elements = {};
        options.elements.line = {};
        options.elements.point = {};
        options.scales = {};
        options.title = {};
        options.tooltips = {mode: 'x-axis'};
        options.tooltips.callbacks = {};
        options.legend = {};
        options.legend.labels = {};
        options.elements.line.fill = false;
        options.elements.line.borderWidth = 4;
        options.elements.point.radius = 0;
        options.title.display = true;
        options.legend.display = false;
        options.legend.position = "top";
        options.animation = false;

        options.legend.labels.fontColor = 'red';

        options.scales.xAxes = [{
            barPercentage: 0.2,
            ticks: {
                display: true,
                fontColor: "#AAA"
            },
            gridLines: {
                color: "rgba(0, 255, 0, 0)",
                drawBorder: false,
            }
        }];

        options.scales.yAxes = [{
            ticks: {
                display: true,
                fontColor: "#AAA"
            },
            gridLines: {
                drawBorder: false,
                color: "rgba(94, 114, 228, 0.2)"
            }
        }];

        let ctx2 = document.getElementById("chart-orders").getContext('2d');

        let chart = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: [{{ lastNDays }}],
                datasets: [
                    {
                        label: 'Votes',
                        data: {{ vote_data }},
                        borderColor: window.chartColors.purple,
                        backgroundColor:  window.chartColors.purple,
                        hoverBackgroundColor: window.chartColors.purpleLight,
                        barWidth: 1,
                    }
                ]
            },
            options: options
        });
    </script>
{%  endblock %}